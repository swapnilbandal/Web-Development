<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        .container {
            margin-top: 50px;
        }

        .btn-margin {
            margin-right: 10px;
        }

        .form-control {
            margin-bottom: 10px;
        }   
    </style>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-md-8">
                <h2>Product Management</h2>
                <hr>
                <button onclick="fetchData()" type="button" class="btn btn-primary">Fetch Product List</button>
                <table class="table mt-4">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Price</th>
                            <th>Company</th>
                        </tr>
                    </thead>
                    <tbody id="productTableBody">

                    </tbody>
                </table>
            </div>
            <div class="col-md-4">
                <h2>Add Product</h2>
                <hr>
                <div class="mb-3">
                    <label for="productName" class="form-label">Product Name:</label>
                    <input type="text" class="form-control" id="productName">
                </div>
                <div class="mb-3">
                    <label for="productPrice" class="form-label">Product Price:</label>
                    <input type="text" class="form-control" id="productPrice">
                </div>
                <div class="mb-3">
                    <label for="productCompany" class="form-label">Product Company:</label>
                    <input type="text" class="form-control" id="productCompany">
                </div>
                <button onclick="addProduct()" type="button" class="btn btn-success btn-margin">Add Product</button>
                <hr>
                <h2>Update Product</h2>
                <div class="mb-3">
                    <label for="updateProductId" class="form-label">Product ID:</label>
                    <input type="text" class="form-control" id="updateProductId">
                </div>
                <div class="mb-3">
                    <label for="updateProductName" class="form-label">Product Name:</label>
                    <input type="text" class="form-control" id="updateProductName">
                </div>
                <div class="mb-3">
                    <label for="updateProductPrice" class="form-label">Product Price:</label>
                    <input type="text" class="form-control" id="updateProductPrice">
                </div>
                <div class="mb-3">
                    <label for="updateProductCompany" class="form-label">Product Company:</label>
                    <input type="text" class="form-control" id="updateProductCompany">
                </div>
                <button onclick="updateProduct()" type="button" class="btn btn-warning btn-margin">Update
                    Product</button>
            </div>
        </div>
    </div>

    <script>
        function fetchData() {
            document.getElementById("productTableBody").innerHTML = "";

            // Fetch product data from the server
            fetch("http://localhost:8000/products")
                .then(response => response.json())
                .then(products => {
                    products.forEach(product => {
                        const row = `
                            <tr>
                                <td>${product.id}</td>
                                <td>${product.name}</td>
                                <td>${product.price}</td>
                                <td>${product.company}</td>
                            </tr>
                        `;
                        document.getElementById("productTableBody").innerHTML += row;
                    });
                })
                .catch(error => console.error('Error fetching data:', error));
            console.log("Fetching data...");
        }

        function addProduct() {
            const productName = document.getElementById("productName").value;
            const productPrice = document.getElementById("productPrice").value;
            const productCompany = document.getElementById("productCompany").value;

            const productData = {
                name: productName,
                pprice: productPrice,
                pcompany: productCompany
            };

            fetch('http://localhost:9999/products', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(productData)
            })
            .then(response => response.json())
            .then(() => {
                alert('Product added successfully.');
                document.getElementById("productName").value = "";
                document.getElementById("productPrice").value = "";
                document.getElementById("productCompany").value = "";
                fetchData(); // Refresh product list
            })
            .catch(error => console.error('Error adding product:', error));
        }

        function updateProduct() {
            const productId = document.getElementById("updateProductId").value;
            const productName = document.getElementById("updateProductName").value;
            const productPrice = document.getElementById("updateProductPrice").value;
            const productCompany = document.getElementById("updateProductCompany").value;

            const productData = {
                name: productName,
                pprice: productPrice,
                pcompany: productCompany
            };

            fetch(`http://localhost:9999/products/${productId}`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(productData)
            })
            .then(response => response.json())
            .then(() => {
                alert(`Product ${productId} updated successfully.`);
                document.getElementById("updateProductId").value = "";
                document.getElementById("updateProductName").value = "";
                document.getElementById("updateProductPrice").value = "";
                document.getElementById("updateProductCompany").value = "";
                fetchData(); // Refresh product list
            })
            .catch(error => console.error(`Error updating product ${productId}:`, error));
        }
    </script>
</body>

</html>
